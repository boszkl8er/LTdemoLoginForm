<html>
  <head>
     <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'>
  	<link rel='stylesheet' href='https://unpkg.com/formiojs@latest/dist/formio.full.min.css'>
  	<script src='https://unpkg.com/formiojs@latest/dist/formio.full.min.js'></script>
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!-- include Auth0 -->
	<script src="auth0.min.js"></script>
  	<script type="text/javascript" language="javascript" src="loginForm.json"></script>
 	 <script type='text/javascript'>
   		 window.onload = function () {
      		Formio.createForm(document.getElementById('formio'), loginForm); 
			console.log('after createForm');
			
			
			//---------------------  Debug -----------------------------
			var mainURL = window.location.href;
			console.log('mainURL = '+mainURL);
			
			//------------- get code variable form URL -----------------
			//========================================================================================
			var code_Val = '';
			
			var returnValue = '';
			var findParam = 'code';
			//var findParam = 'session_state';
			//function getParamFromURL(mainURL,param){
			
				var tmpURL = '';
				if(mainURL.indexOf('?')!=-1){
					tmpURL = mainURL.substring(mainURL.indexOf('?')+1,mainURL.length);
					var firstParam = tmpURL.substring(0,tmpURL.indexOf('='));
					var firstValue = '';
					
					if(findParam == firstParam){
						firstValue = tmpURL.substring(tmpURL.indexOf('=')+1,tmpURL.length);
						
						if(firstValue.indexOf('&')!=-1){
							firstValue = firstValue.substring(0,tmpURL.indexOf('&'));
						}else{
							firstValue = firstValue.substring(0,tmpURL.length);
						}
						code_Val = returnValue = firstValue;
						console.log(findParam+'='+returnValue);
						
						//console.log('firstParam = '+firstParam);
						//console.log('firstValue = '+firstValue);
					}else{
						var paramArr = mainURL.split('&');
						//console.log('paramArr.length = '+paramArr.length);
						
						for(var i = 0 ; i < paramArr.length ; i++){
							var paramName = paramArr[i].substring(0,paramArr[i].indexOf('='));
							var paramValue = paramArr[i].substring(paramArr[i].indexOf('=')+1,paramArr[i].length);
							//console.log(paramName+'='+paramValue);
					
							if(findParam == paramName){
								code_Val = returnValue = paramValue;
								console.log(findParam+'='+returnValue);
							}
						}
					}
				}
			
			//}

			//=======================================================================================
			//function get 
			//-----------------------------------------------------------
			//function post
				//var path = 'https://login.microsoftonline.com/3e0b6cbd-4959-4d01-81bf-ce883ddabd96/oauth2/token';
				//var params = 'grant_type=authorization_code';
				//params += '&client_id=0a07a77d-ee2e-477e-93ca-fd7f59421237';
				//params += '&code=AQABAAIAAAABlDrqfEFlSaui6xnRjX5EATAcQ9ONQUhxKbCEk1gn5671oavYuWTFz9mVLsmpb8pCeniTTQFnx3CXaggarVbozyi8fHbJDzQ1oRvV5JlbUH4XvP2KE319545k011JN7Su2TfYgNwMBb4QuBgPRs-pTnhVm1qzadpbbu31r7gDxl1oKFD1KrbdzmPGKv5BMHQ1UlOtgIrTcD0HrV44g0wmc5hTagNzUcn1W9AGcWC0JhpWOhEuPE688KHwMrJzUNVAOyqRg69nvNr_27JtayZrv2Z3yN7rByn5Zkn5bHTpL8GMvbu-ffuvfObSVhEIQpsXdL8_VGProYc-K5alE0SixyPOnix5dHEtAeSS5RLX76TTHbZa6eOSRfg5MQK-wNtT5NHArXomphGQkIV2ggbz2ny8ZovZtIrjicvulMtAOdslGf98EB8Jq_t_lj5yCRG-N9lutPwu3UsGbvpflZv8SyTqHl1mj6PNeWNJ1Zk8wUnrVnExELzhfMmJhFPKgIOy2t4PqGb7qD65kfY1v379-ctsx-THIQHONIPVV1tiH3DqsNfV-gGWAxcbPDEOI94gAA';
				//params += '&redirect_url=https%3A%2F%2Flogin.microsoftonline.com%2F3e0b6cbd-4959-4d01-81bf-ce883ddabd96%2Foauth2%2Fauthorize';
				//params += '&client_secret=Km3aaZ+MavtvfXagfIHQ6bzFWfkXCXZgM8SGJ6VptyI=';
			
				var path = 'https://login.microsoftonline.com/3e0b6cbd-4959-4d01-81bf-ce883ddabd96/oauth2/token';
				var method = 'post';

				// The rest of this code assumes you are not using a library.
				// It can be made less wordy if you use one.
				var form = document.createElement("form");
				form.setAttribute("method", method);
				form.setAttribute("action", path);
				//grant_type
						var hiddenField1 = document.createElement("input");
						hiddenField1.setAttribute("type", "hidden");
						hiddenField1.setAttribute("name", "grant_type");
						hiddenField1.setAttribute("value", "authorization_code");
						form.appendChild(hiddenField1);
						
						var clientIDVal = '0a07a77d-ee2e-477e-93ca-fd7f59421237';
						var hiddenField2 = document.createElement("input");
						hiddenField2.setAttribute("type", "hidden");
						hiddenField2.setAttribute("name", "client_id");
						hiddenField2.setAttribute("value", clientIDVal);
						form.appendChild(hiddenField2);
				
						console.log('code = '+code_Val);
						//var code_Val = 'AQABAAIAAAABlDrqfEFlSaui6xnRjX5EesNAKgQmQ8OtC3mqyVyakjvbLN1bDOLikyDQKYQTYNJskrx6zAXn1b9qzqei-f0XbdgFqbYuyMaxeQnnEONT0QxpXQ1-u_NYQ6vz9p71UyrPUZ1eodvCN06zuAq7kywU0HgdD8qJJHMUFGR_d5QLA8tRCpVShQAmnyFbPaJC9a-YglJtQPm6Anc5m2eO2iG17ULkaGR9joIwkEELLYAc28pQnijBpTinNQI3EO8V6eNiwYbPi2iugh9vD-dCqv6rtzn02GPJ8nTqlsgd5Lb3UsZhaMQKJ6HP1ASMiigtIzX1llPuBI3Ufy5TOFkvQ1dNGelCn4NwtJxM1fJdHJxQZTuOr1uRrqx_5sNf0E7fCcyGxZSaY_Ww1UocrgiDlueacbsC8aSHzWNq4J3kRsQW_z8vBoNzpn5jUNt2_9jqsmP840Cv2kdv3HL0cRj66HsNCk9Wbx4LeuPeqLbb6wJGDg8Z5D9qJkpX6J4WNoe8cg2potBkRUQfTPrbFhuaWKEngsibqOotkAFliP3koEnFMZzm5xso2PIMR-nTNN1ai-FyyQUWlRS9Ax_jE0CxQlekIAA';
						//var code_Val = 'AQABAAIAAAABlDrqfEFlSaui6xnRjX5EATAcQ9ONQUhxKbCEk1gn5671oavYuWTFz9mVLsmpb8pCeniTTQFnx3CXaggarVbozyi8fHbJDzQ1oRvV5JlbUH4XvP2KE319545k011JN7Su2TfYgNwMBb4QuBgPRs-pTnhVm1qzadpbbu31r7gDxl1oKFD1KrbdzmPGKv5BMHQ1UlOtgIrTcD0HrV44g0wmc5hTagNzUcn1W9AGcWC0JhpWOhEuPE688KHwMrJzUNVAOyqRg69nvNr_27JtayZrv2Z3yN7rByn5Zkn5bHTpL8GMvbu-ffuvfObSVhEIQpsXdL8_VGProYc-K5alE0SixyPOnix5dHEtAeSS5RLX76TTHbZa6eOSRfg5MQK-wNtT5NHArXomphGQkIV2ggbz2ny8ZovZtIrjicvulMtAOdslGf98EB8Jq_t_lj5yCRG-N9lutPwu3UsGbvpflZv8SyTqHl1mj6PNeWNJ1Zk8wUnrVnExELzhfMmJhFPKgIOy2t4PqGb7qD65kfY1v379-ctsx-THIQHONIPVV1tiH3DqsNfV-gGWAxcbPDEOI94gAA';
						var hiddenField3 = document.createElement("input");
						hiddenField3.setAttribute("type", "hidden");
						hiddenField3.setAttribute("name", "code");
						hiddenField3.setAttribute("value", code_Val);
						form.appendChild(hiddenField3);
						
						var clientSecret_Val = 'Km3aaZ+MavtvfXagfIHQ6bzFWfkXCXZgM8SGJ6VptyI=';
						var hiddenField4 = document.createElement("input");
						hiddenField4.setAttribute("type", "hidden");
						hiddenField4.setAttribute("name", "client_secret");
						hiddenField4.setAttribute("value", clientSecret_Val);
						form.appendChild(hiddenField4);
						
						var redirectURL_Val = 'https%3A%2F%2Flogin.microsoftonline.com%2F3e0b6cbd-4959-4d01-81bf-ce883ddabd96%2Foauth2%2Fauthorize';
						var hiddenField5 = document.createElement("input");
						hiddenField5.setAttribute("type", "hidden");
						hiddenField5.setAttribute("name", "redirect_url");
						hiddenField5.setAttribute("value", redirectURL_Val);
						form.appendChild(hiddenField5);
						
						//var resource_Val = 'https%3A%2F%2Flogin.microsoftonline.com%2F3e0b6cbd-4959-4d01-81bf-ce883ddabd96%2Foauth2%2Fauthorize';
						//var hiddenField6 = document.createElement("input");
						//hiddenField6.setAttribute("type", "hidden");
						//hiddenField6.setAttribute("name", "resource");
						//hiddenField6.setAttribute("value", resource_Val);
						//form.appendChild(hiddenField6);
				
					document.body.appendChild(form);
					console.log('before submit form3');
					alert('before submit form3');
					form.submit();
		};
  	</script>
  </head>
  <body>
		<div id='formio'></div>
  </body>
</html>